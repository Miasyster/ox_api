# 登录功能测试说明

## 测试目标

验证国信证券OX API的登录功能是否正常工作，包括：
1. API实例创建
2. 回调接口注册
3. API初始化
4. 登录请求发送
5. 登录回调接收
6. 登录成功后查询交易账户信息

## 测试环境要求

- Windows 操作系统
- Visual Studio 2015 或更高版本
- 已配置的账户信息（`bin/config/config.ini`）
- 所有必需的DLL文件在 `bin` 目录下

## 测试步骤

### 1. 编译程序

```bash
# 使用 Visual Studio 打开 demo/demo.sln
# 选择 Release 或 Debug 配置
# 编译项目生成 demo.exe
```

### 2. 准备运行环境

确保以下文件存在：
- `bin/GuosenOXAPI.dll`
- `bin/config/config.ini`
- `bin/Tradelog.prop`
- `bin/gxtrade.ini`
- 其他依赖的 DLL 文件

### 3. 运行测试

**方法A：使用启动脚本（推荐）**
```bash
cd demo
start.bat
```

**方法B：直接运行**
```bash
cd bin
demo.exe --file=config/config.ini
```

### 4. 观察输出

程序会输出详细的登录流程信息：

```
========== 开始登录流程 ==========

[1/4] 创建API实例...
✓ API实例创建成功: 0x...

[2/4] 注册回调接口...
✓ 回调接口注册成功

[3/4] 初始化API...
✓ API初始化成功

[4/4] 发送登录请求...
  账户: 620000259568
  账户类型: 0
✓ 登录请求已发送，等待回调...

等待登录回调...
..........

========== 登录回调 ==========
Request ID: 0
Is Last: Yes
Error ID: 0
Error Info: 
✓ 登录成功！
Account: 620000259568

正在查询交易账户信息...

========== 交易账户查询回调 ==========
Request ID: 0
Is Last: Yes
✓ 交易账户信息：
  交易所代码: 10
  交易账户: A354038998
============================

✓✓✓ 登录流程完成！✓✓✓
============================
```

## 预期结果

### 成功情况

1. ✅ API实例创建成功
2. ✅ 回调接口注册成功
3. ✅ API初始化成功（返回码为0）
4. ✅ 登录请求发送成功（返回码为0）
5. ✅ 收到登录回调（`OnRspLogon` 被调用）
6. ✅ 登录成功（`ErrorId == 0`）
7. ✅ 自动查询交易账户信息成功
8. ✅ 收到交易账户查询回调

### 失败情况

如果登录失败，程序会显示详细的错误信息：

```
✗ 登录失败！
  错误信息: [具体错误信息]
```

## 常见问题排查

### 1. API初始化失败

**可能原因**：
- DLL文件缺失或路径不正确
- `Tradelog.prop` 路径问题
- 配置文件路径错误

**解决方案**：
- 确保所有DLL文件在 `bin` 目录下
- 检查工作目录是否正确（程序会自动切换到 `bin` 目录）
- 检查 `Tradelog.prop` 文件是否存在

### 2. 登录超时

**可能原因**：
- 网络连接问题
- 服务器不可达
- 账户信息错误

**解决方案**：
- 检查网络连接
- 验证账户和密码是否正确
- 检查防火墙设置

### 3. 登录失败（ErrorId != 0）

**可能原因**：
- 账户或密码错误
- 账户类型不匹配
- 账户被锁定或禁用

**解决方案**：
- 检查 `config.ini` 中的账户信息
- 确认账户类型设置正确（0-现货，1-期权，2-期货，3-信用）
- 联系券商确认账户状态

### 4. 未收到交易账户查询回调

**可能原因**：
- 登录成功但查询请求失败
- 回调处理有问题

**解决方案**：
- 检查回调函数实现
- 查看日志文件 `bin/LOG/tradeapi.log`

## 日志文件

程序运行过程中会生成日志文件：
- `bin/LOG/tradeapi.log` - 交易API日志
- `bin/LOG/ua.log` - UA相关日志

查看日志文件可以帮助诊断问题。

## 测试检查清单

- [ ] 程序能够成功编译
- [ ] 所有DLL文件存在且可访问
- [ ] 配置文件格式正确
- [ ] API实例创建成功
- [ ] 回调接口注册成功
- [ ] API初始化成功
- [ ] 登录请求发送成功
- [ ] 收到登录回调
- [ ] 登录成功（ErrorId == 0）
- [ ] 自动查询交易账户信息
- [ ] 收到交易账户查询回调
- [ ] 日志文件正常生成

## 下一步

登录功能验证通过后，可以继续：
1. 测试查询功能（资金、持仓、委托等）
2. 测试下单功能
3. 测试撤单功能
4. 开始开发C++中间服务

