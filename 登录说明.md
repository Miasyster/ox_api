# 国信证券 OX 交易 API 登录说明

## 当前配置信息

根据 `bin/config/config.ini` 配置文件：

- **资金账号**: 620000259568
- **账户类型**: 0 (现货账户)
- **密码**: 111111
- **上海交易账户**: A354038998
- **深圳交易账户**: 0148211801

## 登录方法

### 方法一：使用 C++ Demo 程序（推荐）

1. **编译程序**
   ```bash
   # 在 Windows 系统上
   # 使用 Visual Studio 打开 demo/demo.sln
   # 编译生成 demo.exe
   ```

2. **运行程序**
   ```bash
   # 确保所有 DLL 文件在 demo.exe 同目录下
   cd demo
   demo.exe --file=config/config.ini
   ```

3. **登录流程**
   - 程序会自动读取配置文件
   - 调用 `OnReqLogon` 进行登录
   - 登录结果通过 `OnRspLogon` 回调返回
   - 登录成功后，`g_logedOn` 标志会被设置为 `true`

### 方法二：使用 Python 测试脚本

**注意**: 此方法需要在 Windows 系统上运行。

1. **运行测试脚本**
   ```bash
   # 在 Windows 系统上
   python test_login.py
   ```

2. **脚本功能**
   - 自动读取配置文件
   - 加载 DLL 文件
   - 创建 API 实例
   - 初始化 API
   - 发送登录请求
   - 显示登录结果

## 登录代码示例

### C++ 代码（来自 main.cpp）

```cpp
// 1. 创建 API 实例
g_TradeApi = gxCreateTradeApi();

// 2. 注册回调
StkSpi stkSpi;
g_TradeApi->RegisterSpi(&stkSpi);

// 3. 初始化
const char *pError = nullptr;
int iInitRet = g_TradeApi->Init(&pError);

// 4. 登录
COXReqLogonField req;
snprintf(req.Account, sizeof(req.Account), "%s", g_acct.c_str());
req.AcctType = g_acctType;  // 账户类型
snprintf(req.Password, sizeof(req.Password), "%s", g_passwd.c_str());
int iLogon = g_TradeApi->OnReqLogon(0, &req);

// 5. 等待登录完成
while(!g_logedOn)
    std::this_thread::yield();
```

### 登录回调处理

```cpp
virtual void OnRspLogon(int nRequest, const CRspErrorField *pError, 
                        bool bLast, const COXRspLogonField *pField) override
{
    std::cout << __FUNCTION__ << " called : " << pError->ErrorInfo << std::endl;
    if (pError->ErrorId == 0) {
        // 登录成功
        g_logedOn = true;
    } else {
        // 登录失败
        std::cout << "登录失败: " << pError->ErrorInfo << std::endl;
    }
}
```

## 账户类型说明

- `'0'` - 现货账户 (OX_ACCOUNT_STOCK)
- `'1'` - 期权账户 (OX_ACCOUNT_OPTION)
- `'2'` - 期货账户 (OX_ACCOUNT_FUTURE)
- `'3'` - 信用账户 (OX_ACCOUNT_CREDIT)

当前配置使用的是现货账户 (`acct_type=0`)。

## 注意事项

1. **系统要求**: 必须在 Windows 系统上运行，因为依赖 Windows DLL 文件
2. **DLL 文件**: 确保所有必需的 DLL 文件在可执行文件目录或系统 PATH 中
3. **网络连接**: 需要稳定的网络连接到国信证券交易服务器
4. **交易时间**: 登录功能可以在非交易时间使用，但某些查询功能可能受限
5. **配置文件**: 确保配置文件中的账户信息准确无误

## 故障排查

### 如果登录失败：

1. **检查配置文件**
   - 确认 `bin/config/config.ini` 中的账户和密码正确
   - 确认账户类型设置正确

2. **检查 DLL 文件**
   - 确认 `bin/GuosenOXAPI.dll` 存在
   - 确认所有依赖的 DLL 文件都在正确位置

3. **检查网络连接**
   - 确认能够连接到国信证券交易服务器
   - 检查防火墙设置

4. **查看日志**
   - 检查 `bin/LOG/` 目录下的日志文件
   - 查看错误信息

5. **检查回调函数**
   - 确认 `OnRspLogon` 回调函数被正确实现
   - 查看回调中的错误信息

## 相关文件

- 配置文件: `bin/config/config.ini`
- C++ 示例代码: `demo/main.cpp`
- Python 测试脚本: `test_login.py`
- API 头文件: `include/OXTradeApi.h`
- API 文档: `doc/API使用说明.docx`

